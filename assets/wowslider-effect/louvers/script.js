// louvers
// options.cols - number of cols
// options.perspective - 3d perspective size

// easing functions
jQuery.extend(jQuery.easing,{easeInBack:function(b,a,f,q,p,c){void 0==c&&(c=1.70158);return q*(a/=p)*a*((c+1)*a-c)+f},easeOutBack:function(b,a,f,q,p,c){void 0==c&&(c=1.70158);return q*((a=a/p-1)*a*((c+1)*a+c)+1)+f},easeInBackQ:function(b,a,f,q,p,c){b=(a/=p)*a;return f+q*b*(4*a*b-8*b+8*a-3)},easeOutBackQ:function(b,a,f,q,p,c){b=(a/=p)*a;return f+q*(4*b*a*b-12*b*b+16*b*a-13*b+6*a)},easeInBackQ2:function(b,a,f,q,p,c){b=(a/=p)*a;return f+q*b*(1.5*a*b-2.5*b+5*a-3)},easeOutBackQ2:function(b,a,f,q,p,c){b=
(a/=p)*a;return f+q*(1.5*b*a*b-5*b*b+10*b*a-12*b+6.5*a)}});
function ws_louvers(b,a,f){function q(m){for(var f={},n=a.get(m),v=b.width/u,r=b.height,l=0;l<u;l++){m=l%u;var N=l;a:{var d=n,g={x:m*v,y:Math.floor(l/u)*r,w:v,h:r},g=g||{};m=g.exclude||[];var x=void 0,k=document.createElement("canvas"),h=k.getContext("2d");k.width=d.naturalWidth;k.height=d.naturalHeight;h.drawImage(d,0,0,d.naturalWidth,d.naturalHeight);try{x=h.getImageData(g.x?g.x:0,g.y?g.y:0,g.w?g.w:d.width,g.h?g.h:d.height).data}catch(O){console.log("error:unable to access image data: "+O);m="#ccc";
break a}for(var d=(g.w?g.w:d.width*g.h?g.h:d.height)||x.length,g={},k="",h=[],G="",H=0,c=0;c<d;){h[0]=x[c];h[1]=x[c+1];h[2]=x[c+2];k=h.join(",");g[k]=k in g?g[k]+1:1;if(-1===m.indexOf(["rgb(",k,")"].join(""))){var e=g[k];e>H&&(G=k,H=e)}c+=4}m=["rgb(",G,")"].join("")}f[N]=m}return f}function p(b,a){var f=0,c;for(c in b)"function"!==typeof b[c]&&function(b,l){wowAnimate(function(a){var d,g,f,k="",h={};.5>=a?(d=n.easing.easeInBack(1,2*a,0,1,1,1).toFixed(3),g=n.easing.easeInBackQ(1,2*a,0,1,1,1).toFixed(3),
f=n.easing.easeInBackQ2(1,2*a,0,1,1,1).toFixed(3),l[b].back.css("backfaceVisibility","hidden")):(d=n.easing.easeOutBack(1,2*(a-.5),0,1,1,1).toFixed(3),g=n.easing.easeOutBackQ(1,2*(a-.5),0,1,1,1).toFixed(3),f=n.easing.easeOutBackQ2(1,2*(a-.5),0,1,1,1).toFixed(3),l[b].back.css("backfaceVisibility","visible"));for(var c in l[b].animate[.5>=a?"half":"end"]){var m=l[b].animate[.5>=a?"begin":"half"][c]||0,e=l[b].animate[.5>=a?"half":"end"][c]||0;"object"!==typeof e&&(e="scale"===c||"rotateX"===c||"rotateY"===
c?m+(e-m)*g:"left"===c||"top"===c?m+(e-m)*f:m+(e-m)*d);"rotateX"===c||"rotateY"===c||"rotateZ"===c?k+=c+"("+e+"deg) ":"scale"===c?k+=c+"("+e+") ":"translate3d"===c?k+=c+"("+(m[0]+(e[0]-m[0])*d).toFixed(3)+"px,"+(m[1]+(e[1]-m[1])*d).toFixed(3)+"px,"+(m[2]+(e[2]-m[2])*d).toFixed(3)+"px) ":h[c]=e}l[b].wrapper.css({transform:"translate3d("+(h.left?h.left:0).toFixed(3)+"px,"+(h.top?h.top:0).toFixed(3)+"px,0)"});delete h.left;delete h.top;k&&(h.transform=k);l[b].part.css(h)},0,1,l[b].animate.duration,l[b].animate.delay,
function(){f++;f==l.length&&a&&a()})}(c,b)}function c(a,c,n,v){var r=f.width(),l=f.height(),q=r/u,d=1E3<.4*b.duration?1E3:.4*b.duration,g=.6*b.duration,x=[0,0];c=D[c];for(var k in a)"function"!==typeof e[k]&&(a[k].topEdge.css({width:q,height:5,background:c[k],transform:"rotateX(90deg) translate3d(0,-2.5px,2.5px)"}),a[k].bottomEdge.css({width:q,height:5,background:c[k],transform:"rotateX(90deg) translate3d(0,-2.5px,"+(-l+2.5)+"px)"}),a[k].leftEdge.css({width:5,height:l,background:c[k],transform:"rotateY(90deg) translate3d(2.5px,0,-2.5px)"}),
a[k].rightEdge.css({width:5,height:l,background:c[k],transform:"rotateY(90deg) translate3d(2.5px,0,"+(q-2.5)+"px)"}));B.css({transformOrigin:r/2+"px "+l/2+"px 0",width:r,height:l});for(var h in a)"function"!==typeof a[h]&&(r=y[h].delay*d,x[1]<=r&&(x[0]=h,x[1]=r),a[h].part[0].ws_delay=[r,0]);a[x[0]].part[0].ws_delay[1]=1;for(h in a)"function"!==typeof a[h]&&(d=a[h],d.animate={delay:d.part[0].ws_delay[0],duration:g,begin:{left:0,top:0,width:q,height:l,scale:1,rotateX:0,rotateY:0,translate3d:[0,0,E?
5:0]},half:{left:y[h].halfLeft*q,top:y[h].halfTop*l,scale:y[h].halfScale,rotateX:y[h].rotateX/2,rotateY:y[h].rotateY/2,translate3d:[0,0,5*(E?1:.5)]},end:{left:0,top:0,scale:1,rotateX:y[h].rotateX,rotateY:y[h].rotateY,translate3d:[0,0,5]}},d.front.find("img").css(n),d.back.css("backfaceVisibility","hidden").find("img").css(n),d.part.css({width:d.animate.begin.width,height:d.animate.begin.height,left:d.animate.begin.left,top:d.animate.begin.top}));p(a,v)}var n=jQuery,I=n(this),u=b.cols||10,w=b.perspective||
2E3,F=f.find(".ws_list"),e=[],D={},B=n("<div>").addClass("ws_effect ws_louvers").appendTo(f),z=b.support.transform&&b.support.transition&&b.support.perspective,E=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/WOW Slider/g.test(navigator.userAgent),y=[];B.css({position:"absolute",top:0,left:0,width:f.width(),height:f.height(),transform:"translate3d(0,0,0)",transformOrigin:b.width/2+"px "+b.height/2+"px 0",perspective:w+2E3}).hide();for(w=0;w<u;w++){var t=w%u,J=Math.floor(w/
u),K=n("<div>").css({position:"absolute",left:100*t/u+"%",top:0,outline:"1px solid transparent",transformStyle:E?"flat":"preserve-3d",overflow:z?"visible":"hidden"}).appendTo(B),A=n("<div>").css({transform:"scale(1) rotateX(0) rotateY(0) translate3d(0,0,0)",outline:"1px solid transparent",transformStyle:"preserve-3d"}).appendTo(K),L=n("<div>").addClass("ws_front_image").appendTo(A),M=z?n("<div>").addClass("ws_back_image").appendTo(A):0;L.css({position:"absolute",width:"100%",height:"100%",overflow:"hidden",
backfaceVisibility:"hidden",transform:"translate3d(0,0,0)"}).append(n("<img>").css({left:100*-t+"%",top:100*-J+"%",position:"absolute",outline:"1px solid transparent"}));z&&M.css({position:"absolute",width:"100%",height:"100%",overflow:"hidden",backfaceVisibility:"hidden",transform:"rotateY(180deg) translate3d(0,0,5px)"}).append(n("<img>").css({left:100*-t+"%",top:100*-J+"%",position:"absolute",outline:"1px solid transparent"}));t={position:"absolute",outline:"1px solid transparent"};e[w]={part:A,
front:L,back:M,wrapper:K,leftEdge:z?n("<div>").addClass("ws_left_edge").css(t).appendTo(A):0,rightEdge:z?n("<div>").addClass("ws_right_edge").css(t).appendTo(A):0,topEdge:z?n("<div>").addClass("ws_top_edge").css(t).appendTo(A):0,bottomEdge:z?n("<div>").addClass("ws_bottom_edge").css(t).appendTo(A):0}}var C;this.go=function(m,p){if(C)return p;B.show();var t=n(a.get(p)),t={width:t.width(),height:t.height(),marginTop:parseFloat(t.css("marginTop")),marginLeft:parseFloat(t.css("marginLeft"))};y=function(){for(var a=
[0,1],b=[1.2,.8],c=[.2,0,-.2],d=[180,-180],a=a[Math.floor(Math.random()*a.length)],b=b[Math.floor(Math.random()*b.length)],c=c[Math.floor(Math.random()*c.length)],d=d[Math.floor(Math.random()*d.length)],f=u,g=[],e=a?0:f;a?e<=f:0<=e;a?e++:e--)g.push({zIndex:e-(a?f:0),rotateY:d,delay:e/f,halfScale:b,halfLeft:c});return g}();if(z){e[0].front.find("img").on("load",function(){F.hide()});for(var v in e)"function"!==typeof e[v]&&(e[v].front.find("img").attr("src",a.get(p).src),e[v].back.find("img").attr("src",
a.get(m).src));D[p]||(D[p]=q(p));C=new c(e,p,t,function(){F.show();I.trigger("effectEnd");B.hide();for(var a in e)"function"!==typeof e[a]&&e[a].part.css({transition:"",transform:"rotateX(0) rotateY(0) translate3d(0,0,0)"});C=0})}else{C=!0;var r=f.width(),l=f.height(),w=r/u;B.css({width:r,height:l});var d=0;for(v in e){var r=v%u,g=Math.floor(v/u);e[v].front.find("img").attr("src",a.get(m).src).css(t);r=b.duration*(1-Math.abs((5-r*g)/(2*u)));g=0<3*Math.random()+-1?1:-1;e[v].wrapper.css({width:w,height:l});
e[v].part.css({position:"absolute",top:0,left:g*w,opacity:0,width:w,height:l}).animate({left:0,opacity:1},r,function(){d++;d==u&&(F.stop(1,1),C=!1,I.trigger("effectEnd"))})}}}};
